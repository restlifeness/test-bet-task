# Тестовое задание

## Архитектура решения

Для реализации межсервисного взаимодействия была выбрана модель `pub-sub` (publisher-subscriber). Эта модель обеспечивает эффективное и масштабируемое распределение событий между сервисами. Основной обмен данными происходит через HTTP-запросы к `callback URL`, что позволяет подписчикам обрабатывать полученные события по мере их поступления.

### Компоненты системы

1. **`line-provider`**:
   - Отвечает за создание и обновление событий, формируя данные для публикации.

2. **`line-provider-worker`**:
   - Выполняет асинхронную обработку очереди задач, связанных с оповещением подписчиков.
   - Посылает HTTP-запросы ко всем зарегистрированным `subscribers`, не нагружая основной сервис `line-provider`.

3. **Очереди задач**

4. **Subscribers (подписчики)**:
   - Сервисы, подписанные на события `line-provider`.
   - Получают уведомления о новых и обновленных событиях через заранее зарегистрированные `callback URL`.

![bet-services drawio](https://github.com/user-attachments/assets/f1cc442a-c242-439c-a4ca-8a3afae53463)

## Технологии

- **Python**
  - FastAPI
  - SQLAlchemy
  - Alembic
  - PyTest
- **PostgreSQL**
- **Redis**
- **Docker**
- **docker-compose**

## Запуск

1. **Переменные окружения**

   Необходимо определить переменные окружения в файлах `.env` по шаблону `.env.example` в каждом проекте.

2. **Запуск**

   Для запуска необходимо выполнить команду `docker-compose up -d`.

3. **Настройка callback URL**

   Для настройки `callback URL` необходимо открыть API Swagger сервиса `line-provider` по стандартному адресу `/docs`. Перейти к `[POST] /api/v1/subscribers/` и ввести необходимый `callback URL`.

   При запуске через `docker-compose` необходимым `base_url` для `callback URL` является `http://bet-maker-app:{PORT}`, а `path` — `/api/v1/events/external/update`.
